syntax = "proto3";

package com.fanaujie.ripple.protobuf;

option java_multiple_files = true;
option java_package = "com.fanaujie.ripple.protobuf.msgapiserver";


message SingleMessageContent {
  string text = 2;
  string file_url = 3;
  string file_name = 4;
}

message GroupCommandMessageContent {
  int32  command_type = 1;
  string text = 2;
}

message SendMessageReq {
  int64 sender_id = 1;
  string conversation_id = 2;
  int64 receiver_id = 3;
  int64 group_id = 4;
  int64 message_id = 5;
  int64 send_timestamp = 6;
  oneof message {
    SingleMessageContent single_message_content = 7;
    GroupCommandMessageContent group_command_message_content = 8;
  };
}

message SendMessageResp {
}


message SelfInfoUpdateEvent {
  enum EventType {
    UNSPECIFIED = 0;
    UPDATE_NICK_NAME = 1;
    UPDATE_AVATAR = 2;
    DELETE_AVATAR = 3;
  }
  EventType event_type = 1;
  int64 user_id = 2;
  string nickName = 3;
  string avatar = 4;
}


message RelationEvent {
  enum EventType {
    UNSPECIFIED = 0;
    ADD_FRIEND = 1;
    REMOVE_FRIEND = 2;
    UPDATE_FRIEND_REMARK_NAME = 3;
    BLOCK_STRANGER = 4;
    BLOCK_FRIEND = 5;
    UNBLOCK_USER = 6;
    HIDE_BLOCKED_USER = 7;
  }
  EventType event_type = 1;
  int64 user_id = 2;
  int64 target_user_id = 3;
  string target_user_nick_name = 4;
  string target_user_avatar = 5;
  string target_user_remark_name = 6;
}

message SendEventReq {
  oneof event {
    SelfInfoUpdateEvent self_info_update_event = 1;
    RelationEvent relation_event = 2;
  }
  int64 send_timestamp = 3;
}

message SendEventResp {
}


message GroupCreateCommand {
  string group_name = 1;
  string group_avatar = 2;
  repeated int64 member_ids = 3;
}

message  GroupInviteCommand {
  repeated int64 new_member_ids = 1;
  string group_name = 2;
  string group_avatar = 3;
}

message GroupQuitCommand {
  int64 user_id = 1;
}

message GroupUpdateInfoCommand {
  enum UpdateType {
    UNSPECIFIED = 0;
    UPDATE_NAME = 1;
    UPDATE_AVATAR = 2;
  }
  UpdateType update_type = 1;
  string new_name = 2;
  string new_avatar = 3;
}



message SendGroupCommandReq {
  int64 sender_id = 1;
  int64 group_id = 2;
  int64 message_id = 3;
  int64 send_timestamp = 4;
  oneof command_content {
    GroupCreateCommand group_create_command = 5;
    GroupInviteCommand group_invite_command = 6;
    GroupQuitCommand group_quit_command = 7;
    GroupUpdateInfoCommand group_update_info_command = 8;
  };
}

message SendGroupCommandResp {
}

service MessageAPI {
  rpc SendMessage(SendMessageReq) returns (SendMessageResp);
  rpc SendEvent(SendEventReq) returns (SendEventResp);
  rpc SendGroupCommand(SendGroupCommandReq) returns (SendGroupCommandResp);
}